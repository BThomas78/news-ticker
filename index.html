<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>News Ticker</title>
  <style>
    :root {
      --bg: #0b1220;
      --fg: #ffffff;
      --muted: rgba(255,255,255,.75);
      --accent: rgba(255,255,255,.25);
      --speed: 15s; /* lower = faster */
      --gap: 60px;
      --font: 14px;
      --pad-y: 10px;
      --pad-x: 14px;
    }

    html, body { height: 100%; margin: 0; }
    body {
      background: var(--bg);
      color: var(--fg);
      font: 600 var(--font)/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow: hidden;
    }

    .wrap {
      height: 100%;
      display: flex;
      align-items: center;
      border: 1px solid var(--accent);
      box-sizing: border-box;
    }

    .label {
      padding: var(--pad-y) var(--pad-x);
      border-right: 1px solid var(--accent);
      white-space: nowrap;
      color: var(--muted);
      font-weight: 700;
      letter-spacing: .02em;
    }

    .marquee {
      position: relative;
      flex: 1;
      overflow: hidden;
    }

    .track {
      display: inline-flex;
      align-items: center;
      white-space: nowrap;
      will-change: transform;
      animation: scroll var(--speed) linear infinite;
    }

    .item {
      display: inline-flex;
      align-items: center;
      margin-right: var(--gap);
      gap: 10px;
    }

    .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--muted);
      opacity: .85;
      flex: 0 0 auto;
    }

    a {
      color: var(--fg);
      text-decoration: none;
    }
    a:hover { text-decoration: underline; }

    .source {
      color: var(--muted);
      font-weight: 700;
    }

    @keyframes scroll {
      from { transform: translateX(0); }
      to   { transform: translateX(-50%); }
    }

    /* pause on hover (nice for kiosks) */
    .marquee:hover .track { animation-play-state: paused; }

    /* small screens */
    @media (max-width: 600px) {
      :root { --font: 13px; --gap: 40px; }
      .label { display: none; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="label">LIVE NEWS</div>
    <div class="marquee">
      <div id="track" class="track" aria-live="polite"></div>
    </div>
  </div>

  <script>
    // --- CONFIG: add/remove feeds here ---
    const FEEDS = [
      { name: "CNN", url: "https://rss.cnn.com/rss/cnn_topstories.rss" },
      { name: "ABC", url: "https://feeds.abcnews.com/abcnews/topstories" },
      { name: "CBS", url: "https://www.cbsnews.com/latest/rss/main" },
      { name: "NBC", url: "https://feeds.nbcnews.com/nbcnews/public/news" },
      { name: "FOX", url: "https://moxie.foxnews.com/google-publisher/latest.xml" },
      { name: "NPR", url: "https://feeds.npr.org/1001/rss.xml" },
      { name: "BBC", url: "https://feeds.bbci.co.uk/news/world/rss.xml" },
      // Emergency-ish:
      { name: "NWS-IL", url: "https://www.weather.gov/rss_alerts.php?state=il" }
    ];

    const MAX_ITEMS_PER_FEED = 6;     // keep it light
    const MAX_TOTAL_ITEMS = 40;       // cap total
    const REFRESH_MINUTES = 10;       // refresh headlines
    const track = document.getElementById("track");

    // rss2json proxy (free tier, may rate-limit)
    const RSS2JSON = (feedUrl) =>
      "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(feedUrl);

    const clean = (s) => (s || "")
      .replace(/\s+/g, " ")
      .replace(/&amp;/g, "&")
      .replace(/&quot;/g, '"')
      .replace(/&#39;/g, "'")
      .trim();

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    async function fetchFeed(feed) {
      const res = await fetch(RSS2JSON(feed.url), { cache: "no-store" });
      if (!res.ok) throw new Error("Feed fetch failed: " + feed.name);
      const data = await res.json();

      const items = (data.items || []).slice(0, MAX_ITEMS_PER_FEED).map(it => ({
        title: clean(it.title),
        link: it.link,
        source: feed.name
      })).filter(it => it.title && it.link);

      return items;
    }

    function render(items) {
      // Build one sequence and then duplicate it for seamless scroll
      const html = items.map(it => `
        <span class="item">
          <span class="dot" aria-hidden="true"></span>
          <span class="source">${it.source}:</span>
          <a href="${it.link}" target="_blank" rel="noopener noreferrer">${it.title}</a>
        </span>
      `).join("");

      // Duplicate content so animation can translate -50%
      track.innerHTML = html + html;
    }

    async function load() {
      try {
        const results = await Promise.allSettled(FEEDS.map(fetchFeed));
        let items = [];
        for (const r of results) {
          if (r.status === "fulfilled") items.push(...r.value);
        }

        // Deduplicate by title
        const seen = new Set();
        items = items.filter(it => {
          const key = it.title.toLowerCase();
          if (seen.has(key)) return false;
          seen.add(key);
          return true;
        });

        items = shuffle(items).slice(0, MAX_TOTAL_ITEMS);

        if (items.length === 0) {
          track.innerHTML = `<span class="item"><span class="dot"></span><span class="source">STATUS:</span> <span>No headlines available</span></span>`;
          return;
        }

        render(items);

      } catch (e) {
        track.innerHTML = `<span class="item"><span class="dot"></span><span class="source">ERROR:</span> <span>${clean(e.message)}</span></span>`;
      }
    }

    load();
    setInterval(load, REFRESH_MINUTES * 60 * 1000);
  </script>
</body>
</html>
